<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBuddy Pro - Ultimate Student Productivity Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* CSS Variables for Theming */
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
            --accent: #e74c3c;
            --accent-dark: #c0392b;
            --warning: #f39c12;
            --warning-dark: #e67e22;
            --info: #9b59b6;
            --info-dark: #8e44ad;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --success: #28a745;
            --danger: #dc3545;
            --watch-glow: #ff0000;
            --watch-bg: #1a1a1a;
            --bg-light: #f4f4f9;
            --bg-dark: #2c3e50;
            --text-light: #333;
            --text-dark: #ecf0f1;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        /* Dark Theme Variables */
        .dark-theme {
            --bg-light: #1e2a3a;
            --text-light: #ecf0f1;
            --bg-dark: #2c3e50;
            --text-dark: #bdc3c7;
            --light: #2c3e50;
            --gray-light: #34495e;
        }

        /* Blue Theme */
        .blue-theme {
            --primary: #2980b9;
            --primary-dark: #1c5d87;
            --secondary: #3498db;
            --secondary-dark: #2980b9;
        }

        /* Green Theme */
        .green-theme {
            --primary: #27ae60;
            --primary-dark: #219955;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
        }

        /* Purple Theme */
        .purple-theme {
            --primary: #8e44ad;
            --primary-dark: #7d3c98;
            --secondary: #9b59b6;
            --secondary-dark: #8e44ad;
        }

        /* Focus Mode Theme */
        .focus-theme {
            --primary: #e74c3c;
            --primary-dark: #c0392b;
            --secondary: #e74c3c;
            --secondary-dark: #c0392b;
            --bg-light: #000;
            --text-light: #fff;
        }

        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
            color: var(--text-light);
            transition: var(--transition);
            font-size: 16px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }

        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: none;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background-color: rgba(255,255,255,0.1);
            border-left-color: white;
        }

        .menu-item i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .menu-badge {
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: auto;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        /* Header */
        .header {
            height: var(--header-height);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 99;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-action {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .header-action:hover {
            color: var(--primary);
        }

        .header-action-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        /* Focus Mode Styles */
        .focus-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000, #1a1a1a);
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .focus-mode.active {
            display: flex;
        }

        .focus-header {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }

        .focus-subject {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ff4444;
        }

        .focus-actions {
            display: flex;
            gap: 15px;
        }

        .focus-action {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .focus-action:hover {
            background: rgba(255,255,255,0.2);
        }

        .focus-timer {
            text-align: center;
            margin: 20px 0;
            padding: 30px;
            position: relative;
        }

        .focus-watch-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto;
        }

        .focus-watch-face {
            fill: #333;
            stroke: var(--watch-glow);
            stroke-width: 5;
        }

        .focus-tick {
            stroke: var(--text-dark);
            stroke-width: 2;
            transform-origin: center;
            animation: tick 1s infinite;
        }

        .focus-progress-ring circle {
            fill: none;
            stroke-width: 10;
        }

        .focus-progress-ring .bg {
            stroke: #555;
        }

        .focus-progress-ring .fg {
            stroke: var(--watch-glow);
            stroke-dasharray: 1130.97;
            stroke-dashoffset: 1130.97;
            transition: stroke-dashoffset 0.5s linear;
        }

        #focus-timer {
            font-size: 4.5em;
            font-weight: bold;
            color: var(--watch-glow);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 20px rgba(255,0,0,0.7);
        }

        .focus-info {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .focus-stat {
            background-color: rgba(255,255,255,0.1);
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            text-align: center;
        }

        .focus-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--watch-glow);
        }

        .focus-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 20px;
            color: white;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .stat-card.tasks .stat-icon { background-color: var(--primary); }
        .stat-card.notes .stat-icon { background-color: var(--secondary); }
        .stat-card.pomodoro .stat-icon { background-color: var(--accent); }
        .stat-card.streak .stat-icon { background-color: var(--warning); }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin: 0 auto 15px;
            color: white;
        }

        .action-card.add-task .action-icon { background-color: var(--primary); }
        .action-card.add-note .action-icon { background-color: var(--secondary); }
        .action-card.start-timer .action-icon { background-color: var(--accent); }
        .action-card.view-stats .action-icon { background-color: var(--info); }

        .action-card h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .action-card p {
            color: var(--gray);
            font-size: 0.85rem;
        }

        /* Card Styles */
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body {
            padding: 25px;
        }

        /* Input Sections */
        .input-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 150px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .input-section input, .input-section select, .input-section textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }

        .input-section input:focus, .input-section select:focus, .input-section textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .input-section button {
            padding: 12px 25px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-section button:hover {
            background-color: var(--primary-dark);
        }

        .input-section button.secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .input-section button.secondary:hover {
            background-color: var(--gray);
        }

        /* List Styles */
        .list {
            list-style: none;
            margin-bottom: 20px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            background-color: white;
            border-radius: var(--border-radius-sm);
            margin-bottom: 10px;
            transition: var(--transition);
            animation: fadeIn 0.3s ease;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            box-shadow: var(--shadow);
        }

        .list-item.completed {
            text-decoration: line-through;
            opacity: 0.7;
            background-color: var(--gray-light);
        }

        .list-item.pinned {
            border-left: 4px solid var(--warning);
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .list-item-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .list-item-tags {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .tag {
            background-color: var(--gray-light);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--dark);
        }

        .list-item-actions {
            display: flex;
            gap: 5px;
        }

        .list-item button {
            margin-left: 5px;
            padding: 6px 12px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .list-item button.complete { background-color: var(--success); color: white; }
        .list-item button.edit { background-color: var(--warning); color: white; }
        .list-item button.delete { background-color: var(--danger); color: white; }
        .list-item button.pin { background-color: var(--info); color: white; }
        .list-item button:hover { opacity: 0.9; }

        /* Pomodoro Timer Styles */
        .pomodoro {
            text-align: center;
            margin: 20px 0;
            padding: 30px;
            background-color: var(--watch-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px var(--watch-glow); }
            100% { box-shadow: 0 0 20px var(--watch-glow), 0 0 30px rgba(255,0,0,0.5); }
        }

        .watch-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 0 auto;
        }

        .watch-face {
            fill: #333;
            stroke: var(--watch-glow);
            stroke-width: 5;
        }

        .tick {
            stroke: var(--text-dark);
            stroke-width: 2;
            transform-origin: center;
            animation: tick 1s infinite;
        }

        @keyframes tick {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 10;
        }

        .progress-ring .bg {
            stroke: #555;
        }

        .progress-ring .fg {
            stroke: var(--watch-glow);
            stroke-dasharray: 565.48;
            stroke-dashoffset: 565.48;
            transition: stroke-dashoffset 0.5s linear;
        }

        #timer {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--watch-glow);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .pomodoro-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .pomodoro-controls input, .pomodoro-controls select {
            width: 80px;
            padding: 8px;
            background-color: #444;
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
        }

        .pomodoro-controls button {
            padding: 10px 20px;
            background-color: var(--watch-glow);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pomodoro-controls button:hover {
            background-color: #cc0000;
        }

        .pomodoro-info {
            margin-top: 10px;
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .pomodoro-stat {
            background-color: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: var(--border-radius-sm);
        }

        /* Calendar Styles */
        .calendar {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar table {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar th {
            padding: 12px;
            text-align: center;
            background-color: var(--primary);
            color: white;
        }

        .calendar td {
            padding: 12px;
            text-align: center;
            border: 1px solid var(--gray-light);
            height: 100px;
            vertical-align: top;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar td:hover {
            background-color: var(--gray-light);
        }

        .calendar td.today {
            background-color: var(--primary);
            color: white;
        }

        .calendar td.has-event {
            background-color: rgba(52, 152, 219, 0.1);
            position: relative;
        }

        .calendar td.has-event::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: var(--primary);
            border-radius: 50%;
        }

        .calendar-event {
            font-size: 0.7rem;
            background-color: var(--primary);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            margin-top: 2px;
            display: block;
            text-align: left;
        }

        /* Flashcards Styles */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 300px;
            margin: 20px auto;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            background-color: white;
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background-color: var(--primary);
            color: white;
        }

        .flashcard-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .flashcard-set {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .flashcard-set-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        /* Resources Styles */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .resource-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .resource-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: white;
            background-color: var(--primary);
        }

        .resource-card h3 {
            margin-bottom: 10px;
        }

        .resource-card p {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        /* Chart Container */
        .chart-container {
            margin-top: 20px;
            max-width: 100%;
            height: 300px;
        }

        /* Settings Section */
        .settings {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--gray-light);
            border-radius: var(--border-radius);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .settings select, .settings input, .settings button {
            margin: 5px;
            padding: 10px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--gray-light);
            width: 100%;
        }

        .settings button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings button:hover {
            background-color: var(--primary-dark);
        }

        .settings button.danger {
            background-color: var(--danger);
        }

        .settings button.danger:hover {
            background-color: #c82333;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .modal-content p {
            margin-bottom: 20px;
            color: var(--gray);
        }

        .modal-content button {
            margin: 5px;
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-content .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .modal-content .btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .header {
                padding: 0 20px;
            }
            .menu-toggle {
                display: block;
            }
            .sidebar-close {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            .input-section {
                flex-direction: column;
            }
            .input-section input, .input-section select {
                width: 100%;
            }
            .watch-container {
                width: 200px;
                height: 200px;
            }
            .dashboard {
                grid-template-columns: 1fr;
            }
            .quick-actions {
                grid-template-columns: 1fr 1fr;
            }
            .header-title {
                font-size: 1.2rem;
            }
            .focus-watch-container {
                width: 300px;
                height: 300px;
            }
            #focus-timer {
                font-size: 3.5em;
            }
            .calendar td {
                height: 70px;
                padding: 5px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 576px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
            .pomodoro-controls {
                flex-direction: column;
                align-items: center;
            }
            .pomodoro-controls button {
                width: 100%;
                justify-content: center;
            }
            .list-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .list-item-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
            .focus-watch-container {
                width: 250px;
                height: 250px;
            }
            #focus-timer {
                font-size: 2.8em;
            }
            .focus-info {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            .calendar td {
                height: 60px;
                padding: 3px;
                font-size: 0.7rem;
            }
            .resources-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .d-flex { display: flex; }
        .d-none { display: none; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 10px; }
        .mb-2 { margin-bottom: 20px; }
        .mt-1 { margin-top: 10px; }
        .mt-2 { margin-top: 20px; }
        .p-0 { padding: 0; }
        .p-1 { padding: 10px; }
        .p-2 { padding: 20px; }
        .w-100 { width: 100%; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- Focus Mode Overlay -->
    <div class="focus-mode" id="focus-mode">
        <div class="focus-header">
            <div class="focus-subject" id="focus-subject">Mathematics</div>
            <div class="focus-actions">
                <button class="focus-action" id="focus-pause-btn" onclick="pauseFocusTimer()">
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button class="focus-action" id="focus-resume-btn" onclick="resumeFocusTimer()" style="display: none;">
                    <i class="fas fa-play"></i> Resume
                </button>
                <button class="focus-action" onclick="resetFocusTimer()">
                    <i class="fas fa-stop"></i> Reset
                </button>
                <button class="focus-action" onclick="exitFocusMode()">
                    <i class="fas fa-times"></i> Exit
                </button>
            </div>
        </div>
        <div class="focus-timer">
            <div class="focus-watch-container">
                <svg class="focus-watch-face" viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="95" />
                    <g class="ticks">
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(0 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(30 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(60 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(90 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(120 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(150 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(180 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(210 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(240 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(270 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(300 100 100)" />
                        <line class="focus-tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(330 100 100)" />
                    </g>
                    <g class="focus-progress-ring">
                        <circle class="bg" cx="100" cy="100" r="90" />
                        <circle class="fg" id="focus-progress-circle" cx="100" cy="100" r="90" />
                    </g>
                </svg>
                <div id="focus-timer">25:00</div>
            </div>
        </div>
        <div class="focus-info">
            <div class="focus-stat">
                <div class="focus-stat-value" id="focus-session-count">0</div>
                <div class="focus-stat-label">Sessions</div>
            </div>
            <div class="focus-stat">
                <div class="focus-stat-value" id="focus-streak-count">0</div>
                <div class="focus-stat-label">Day Streak</div>
            </div>
            <div class="focus-stat">
                <div class="focus-stat-value" id="focus-status">Ready</div>
                <div class="focus-stat-label">Status</div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-close" id="sidebar-close">
                    <i class="fas fa-times"></i>
                </button>
                <h1><i class="fas fa-graduation-cap"></i> StudyBuddy Pro</h1>
                <p>Your Ultimate Study Companion</p>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="#" class="menu-item" data-section="tasks">
                    <i class="fas fa-tasks"></i> Task Manager
                    <span class="menu-badge" id="task-count">0</span>
                </a>
                <a href="#" class="menu-item" data-section="notes">
                    <i class="fas fa-sticky-note"></i> Notes
                    <span class="menu-badge" id="note-count">0</span>
                </a>
                <a href="#" class="menu-item" data-section="pomodoro">
                    <i class="fas fa-clock"></i> Pomodoro Timer
                </a>
                <a href="#" class="menu-item" data-section="calendar">
                    <i class="fas fa-calendar-alt"></i> Study Calendar
                </a>
                <a href="#" class="menu-item" data-section="flashcards">
                    <i class="fas fa-layer-group"></i> Flashcards
                </a>
                <a href="#" class="menu-item" data-section="resources">
                    <i class="fas fa-book"></i> Study Resources
                </a>
                <a href="#" class="menu-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i> Analytics
                </a>
                <a href="#" class="menu-item" data-section="goals">
                    <i class="fas fa-bullseye"></i> Goals
                </a>
                <a href="#" class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </div>
            <div class="sidebar-footer">
                <p>StudyBuddy Pro v2.0</p>
                <p>Stay Productive!</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="header-action menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title" id="page-title">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="header-action" id="focus-mode-toggle" title="Focus Mode" onclick="enterFocusMode()">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                        <button class="header-action" id="notifications-toggle" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span class="header-action-badge">3</span>
                        </button>
                        <button class="header-action" id="fullscreen-toggle" title="Fullscreen" onclick="toggleFullscreen()">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section active">
                    <div class="dashboard">
                        <div class="stat-card tasks">
                            <div class="stat-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-tasks">0</h3>
                                <p>Total Tasks</p>
                            </div>
                        </div>
                        <div class="stat-card notes">
                            <div class="stat-icon">
                                <i class="fas fa-sticky-note"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-notes">0</h3>
                                <p>Total Notes</p>
                            </div>
                        </div>
                        <div class="stat-card pomodoro">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-sessions">0</h3>
                                <p>Study Sessions</p>
                            </div>
                        </div>
                        <div class="stat-card streak">
                            <div class="stat-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="current-streak">0</h3>
                                <p>Day Streak</p>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-card add-task" onclick="showSection('tasks')">
                            <div class="action-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <h3>Add Task</h3>
                            <p>Create a new study task</p>
                        </div>
                        <div class="action-card add-note" onclick="showSection('notes')">
                            <div class="action-icon">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h3>Add Note</h3>
                            <p>Jot down important information</p>
                        </div>
                        <div class="action-card start-timer" onclick="showSection('pomodoro')">
                            <div class="action-icon">
                                <i class="fas fa-play"></i>
                            </div>
                            <h3>Start Timer</h3>
                            <p>Begin a focused study session</p>
                        </div>
                        <div class="action-card view-stats" onclick="showSection('analytics')">
                            <div class="action-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>View Stats</h3>
                            <p>Check your study progress</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-tasks"></i> Recent Tasks</h2>
                            <button class="btn-secondary" onclick="showSection('tasks')">View All</button>
                        </div>
                        <div class="card-body">
                            <ul id="recent-tasks" class="list"></ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-sticky-note"></i> Recent Notes</h2>
                            <button class="btn-secondary" onclick="showSection('notes')">View All</button>
                        </div>
                        <div class="card-body">
                            <ul id="recent-notes" class="list"></ul>
                        </div>
                    </div>
                </div>

                <!-- Tasks Section -->
                <div id="tasks" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-tasks"></i> Task Manager</h2>
                            <button onclick="exportTasksToPDF()" class="btn-secondary">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="input-section">
                                <div class="input-group">
                                    <label for="task-subject">Subject</label>
                                    <input type="text" id="task-subject" placeholder="e.g., Mathematics" aria-label="Task subject">
                                </div>
                                <div class="input-group">
                                    <label for="task-description">Description</label>
                                    <input type="text" id="task-description" placeholder="Task description" aria-label="Task description">
                                </div>
                                <div class="input-group">
                                    <label for="task-deadline">Deadline</label>
                                    <input type="date" id="task-deadline" aria-label="Task deadline">
                                </div>
                                <div class="input-group">
                                    <label for="task-priority">Priority</label>
                                    <select id="task-priority" aria-label="Task priority">
                                        <option value="1">Low</option>
                                        <option value="3" selected>Medium</option>
                                        <option value="5">High</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="task-tags">Tags</label>
                                    <input type="text" id="task-tags" placeholder="Tags (comma-separated)" aria-label="Task tags">
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button onclick="addTask()"><i class="fas fa-plus"></i> Add Task</button>
                                </div>
                            </div>

                            <div class="input-section">
                                <div class="input-group">
                                    <label for="task-search">Search</label>
                                    <input type="text" id="task-search" placeholder="Search tasks..." aria-label="Search tasks">
                                </div>
                                <div class="input-group">
                                    <label for="task-filter">Filter</label>
                                    <select id="task-filter" aria-label="Filter tasks">
                                        <option value="all">All</option>
                                        <option value="completed">Completed</option>
                                        <option value="pending">Pending</option>
                                        <option value="overdue">Overdue</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="task-sort">Sort By</label>
                                    <select id="task-sort" aria-label="Sort tasks">
                                        <option value="date">Due Date</option>
                                        <option value="priority">Priority</option>
                                        <option value="subject">Subject</option>
                                        <option value="created">Created Date</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button class="secondary" onclick="clearTaskFilters()"><i class="fas fa-times"></i> Clear Filters</button>
                                </div>
                            </div>

                            <ul id="task-list" class="list"></ul>
                        </div>
                    </div>
                </div>

                <!-- Notes Section -->
                <div id="notes" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-sticky-note"></i> Note Organizer</h2>
                            <button onclick="exportNotesToPDF()" class="btn-secondary">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="input-section">
                                <div class="input-group w-100">
                                    <label for="note-content">Note Content</label>
                                    <textarea id="note-content" rows="3" placeholder="Enter your note here..." aria-label="Note content"></textarea>
                                </div>
                            </div>
                            <div class="input-section">
                                <div class="input-group">
                                    <label for="note-tag">Category</label>
                                    <select id="note-tag" aria-label="Note category">
                                        <option value="General">General</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Science">Science</option>
                                        <option value="History">History</option>
                                        <option value="Literature">Literature</option>
                                        <option value="Languages">Languages</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="note-color">Color</label>
                                    <select id="note-color" aria-label="Note color">
                                        <option value="#3498db">Blue</option>
                                        <option value="#2ecc71">Green</option>
                                        <option value="#e74c3c">Red</option>
                                        <option value="#f39c12">Orange</option>
                                        <option value="#9b59b6">Purple</option>
                                        <option value="#1abc9c">Teal</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button onclick="addNote()"><i class="fas fa-plus"></i> Add Note</button>
                                </div>
                            </div>

                            <div class="input-section">
                                <div class="input-group">
                                    <label for="note-search">Search</label>
                                    <input type="text" id="note-search" placeholder="Search notes..." aria-label="Search notes">
                                </div>
                                <div class="input-group">
                                    <label for="note-filter">Filter by Category</label>
                                    <select id="note-filter" aria-label="Filter notes">
                                        <option value="all">All</option>
                                        <option value="General">General</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Science">Science</option>
                                        <option value="History">History</option>
                                        <option value="Literature">Literature</option>
                                        <option value="Languages">Languages</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button class="secondary" onclick="clearNoteFilters()"><i class="fas fa-times"></i> Clear Filters</button>
                                </div>
                            </div>

                            <ul id="note-list" class="list"></ul>
                        </div>
                    </div>
                </div>

                <!-- Pomodoro Timer Section -->
                <div id="pomodoro" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-clock"></i> Pomodoro Timer</h2>
                        </div>
                        <div class="card-body">
                            <div class="pomodoro">
                                <div class="watch-container">
                                    <svg class="watch-face" viewBox="0 0 200 200">
                                        <circle cx="100" cy="100" r="95" />
                                        <g class="ticks">
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(0 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(30 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(60 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(90 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(120 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(150 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(180 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(210 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(240 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(270 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(300 100 100)" />
                                            <line class="tick" x1="100" y1="10" x2="100" y2="20" transform="rotate(330 100 100)" />
                                        </g>
                                        <g class="progress-ring">
                                            <circle class="bg" cx="100" cy="100" r="90" />
                                            <circle class="fg" id="progress-circle" cx="100" cy="100" r="90" />
                                        </g>
                                    </svg>
                                    <div id="timer">25:00</div>
                                </div>
                                <div class="pomodoro-controls">
                                    <select id="timer-preset" aria-label="Timer preset">
                                        <option value="25,5">25 min Work / 5 min Break</option>
                                        <option value="50,10">50 min Work / 10 min Break</option>
                                        <option value="15,3">15 min Work / 3 min Break</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                    <input type="number" id="work-time" value="25" min="1" aria-label="Work time in minutes">
                                    <input type="number" id="break-time" value="5" min="1" aria-label="Break time in minutes">
                                    <input type="text" id="timer-subject" placeholder="Subject (optional)" aria-label="Timer subject">
                                    <button onclick="startPomodoro()"><i class="fas fa-play"></i> Start</button>
                                    <button id="pause-btn" onclick="pausePomodoro()"><i class="fas fa-pause"></i> Pause</button>
                                    <button id="resume-btn" onclick="resumePomodoro()" style="display: none;"><i class="fas fa-play"></i> Resume</button>
                                    <button onclick="resetPomodoro()"><i class="fas fa-stop"></i> Reset</button>
                                    <button onclick="skipBreak()"><i class="fas fa-forward"></i> Skip Break</button>
                                    <button onclick="enterFocusMode()"><i class="fas fa-crosshairs"></i> Focus Mode</button>
                                </div>
                                <div class="pomodoro-info">
                                    <div class="pomodoro-stat">
                                        <p>Session: <span id="session-count">0</span></p>
                                    </div>
                                    <div class="pomodoro-stat">
                                        <p>Streak: <span id="streak-count">0</span> days</p>
                                    </div>
                                    <div class="pomodoro-stat">
                                        <p>Status: <span id="timer-status">Ready</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <h3><i class="fas fa-history"></i> Timer History</h3>
                                <ul id="timer-history" class="list"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Section -->
                <div id="calendar" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-calendar-alt"></i> Study Calendar</h2>
                        </div>
                        <div class="card-body">
                            <div class="calendar-header">
                                <h3 id="calendar-month-year">January 2023</h3>
                                <div class="calendar-nav">
                                    <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                    <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                            <div class="calendar">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Sun</th>
                                            <th>Mon</th>
                                            <th>Tue</th>
                                            <th>Wed</th>
                                            <th>Thu</th>
                                            <th>Fri</th>
                                            <th>Sat</th>
                                        </tr>
                                    </thead>
                                    <tbody id="calendar-body">
                                        <!-- Calendar will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Flashcards Section -->
                <div id="flashcards" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-layer-group"></i> Flashcards</h2>
                        </div>
                        <div class="card-body">
                            <div class="input-section">
                                <div class="input-group">
                                    <label for="flashcard-set-name">Set Name</label>
                                    <input type="text" id="flashcard-set-name" placeholder="e.g., Biology Terms">
                                </div>
                                <div class="input-group">
                                    <label for="flashcard-subject">Subject</label>
                                    <select id="flashcard-subject">
                                        <option value="General">General</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Science">Science</option>
                                        <option value="History">History</option>
                                        <option value="Literature">Literature</option>
                                        <option value="Languages">Languages</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button onclick="createFlashcardSet()"><i class="fas fa-plus"></i> Create Set</button>
                                </div>
                            </div>

                            <div class="input-section">
                                <div class="input-group">
                                    <label for="flashcard-front">Front</label>
                                    <input type="text" id="flashcard-front" placeholder="Term or question">
                                </div>
                                <div class="input-group">
                                    <label for="flashcard-back">Back</label>
                                    <input type="text" id="flashcard-back" placeholder="Definition or answer">
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button onclick="addFlashcard()"><i class="fas fa-plus"></i> Add Card</button>
                                </div>
                            </div>

                            <div id="flashcard-sets">
                                <!-- Flashcard sets will be populated by JavaScript -->
                            </div>

                            <div id="active-flashcard" style="display: none;">
                                <div class="flashcard-container">
                                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                                        <div class="flashcard-front">
                                            <h3 id="flashcard-front-text">Front of card</h3>
                                        </div>
                                        <div class="flashcard-back">
                                            <h3 id="flashcard-back-text">Back of card</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="flashcard-controls">
                                    <button onclick="previousCard()"><i class="fas fa-arrow-left"></i> Previous</button>
                                    <button onclick="nextCard()">Next <i class="fas fa-arrow-right"></i></button>
                                    <button onclick="shuffleCards()"><i class="fas fa-random"></i> Shuffle</button>
                                </div>
                                <div class="text-center mt-2">
                                    <span id="card-counter">Card 1 of 10</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resources Section -->
                <div id="resources" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-book"></i> Study Resources</h2>
                        </div>
                        <div class="card-body">
                            <div class="resources-grid">
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <h3>Video Tutorials</h3>
                                    <p>Access curated video tutorials for various subjects</p>
                                    <button class="btn-secondary">Browse Videos</button>
                                </div>
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-file-pdf"></i>
                                    </div>
                                    <h3>Study Guides</h3>
                                    <p>Download comprehensive study guides and cheat sheets</p>
                                    <button class="btn-secondary">View Guides</button>
                                </div>
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-link"></i>
                                    </div>
                                    <h3>Useful Links</h3>
                                    <p>Collection of helpful websites and online resources</p>
                                    <button class="btn-secondary">Explore Links</button>
                                </div>
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-book-open"></i>
                                    </div>
                                    <h3>E-books</h3>
                                    <p>Digital textbooks and reference materials</p>
                                    <button class="btn-secondary">Browse Books</button>
                                </div>
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-question-circle"></i>
                                    </div>
                                    <h3>Practice Tests</h3>
                                    <p>Test your knowledge with practice exams</p>
                                    <button class="btn-secondary">Take Tests</button>
                                </div>
                                <div class="resource-card">
                                    <div class="resource-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <h3>Study Groups</h3>
                                    <p>Connect with peers for collaborative learning</p>
                                    <button class="btn-secondary">Join Groups</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div id="analytics" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-chart-bar"></i> Study Analytics</h2>
                        </div>
                        <div class="card-body">
                            <div class="input-section">
                                <div class="input-group">
                                    <label for="analytics-period">Time Period</label>
                                    <select id="analytics-period" onchange="updateCharts()">
                                        <option value="7">Last 7 Days</option>
                                        <option value="30" selected>Last 30 Days</option>
                                        <option value="90">Last 3 Months</option>
                                        <option value="365">Last Year</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="progressChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="timeChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="subjectChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Goals Section -->
                <div id="goals" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-bullseye"></i> Study Goals</h2>
                        </div>
                        <div class="card-body">
                            <div class="input-section">
                                <div class="input-group">
                                    <label for="goal-title">Goal Title</label>
                                    <input type="text" id="goal-title" placeholder="e.g., Complete Calculus Course">
                                </div>
                                <div class="input-group">
                                    <label for="goal-description">Description</label>
                                    <input type="text" id="goal-description" placeholder="Goal description">
                                </div>
                                <div class="input-group">
                                    <label for="goal-deadline">Target Date</label>
                                    <input type="date" id="goal-deadline">
                                </div>
                                <div class="input-group">
                                    <label>&nbsp;</label>
                                    <button onclick="addGoal()"><i class="fas fa-plus"></i> Add Goal</button>
                                </div>
                            </div>

                            <div id="goals-list">
                                <!-- Goals will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-cog"></i> Settings</h2>
                        </div>
                        <div class="card-body">
                            <div class="settings">
                                <div class="settings-grid">
                                    <div class="setting-group">
                                        <label>Theme</label>
                                        <select id="theme-select" onchange="changeTheme()" aria-label="Theme selector">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="blue">Blue</option>
                                            <option value="green">Green</option>
                                            <option value="purple">Purple</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <label>Font Size</label>
                                        <select id="font-size" onchange="changeFontSize()" aria-label="Font size selector">
                                            <option value="14">Small</option>
                                            <option value="16" selected>Medium</option>
                                            <option value="18">Large</option>
                                            <option value="20">Extra Large</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <label>Sound Alerts</label>
                                        <input type="checkbox" id="sound-toggle" checked onchange="toggleSound()" aria-label="Toggle sound alerts">
                                    </div>
                                    <div class="setting-group">
                                        <label>Desktop Notifications</label>
                                        <input type="checkbox" id="notifications-toggle" checked onchange="toggleNotifications()" aria-label="Toggle notifications">
                                    </div>
                                    <div class="setting-group">
                                        <label>Auto-start Breaks</label>
                                        <input type="checkbox" id="auto-break-toggle" checked onchange="toggleAutoBreak()" aria-label="Toggle auto-break">
                                    </div>
                                    <div class="setting-group">
                                        <label>Default Work Duration (min)</label>
                                        <input type="number" id="default-work-time" value="25" min="5" max="60" onchange="updateDefaultWorkTime()">
                                    </div>
                                    <div class="setting-group">
                                        <label>Default Break Duration (min)</label>
                                        <input type="number" id="default-break-time" value="5" min="1" max="30" onchange="updateDefaultBreakTime()">
                                    </div>
                                </div>
                                <div class="setting-group">
                                    <button onclick="resetData()" class="danger"><i class="fas fa-trash"></i> Reset All Data</button>
                                    <button onclick="exportData()"><i class="fas fa-download"></i> Export Data</button>
                                    <button onclick="importData()"><i class="fas fa-upload"></i> Import Data</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Confirmations -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <div class="mt-2">
                <button class="btn-primary" onclick="confirmModal()">Confirm</button>
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Enhanced JavaScript with All Features
        // Data Storage
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let timerLogs = JSON.parse(localStorage.getItem('timerLogs')) || [];
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let flashcardSets = JSON.parse(localStorage.getItem('flashcardSets')) || [];
        let calendarEvents = JSON.parse(localStorage.getItem('calendarEvents')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            theme: 'light',
            fontSize: '16px',
            sound: true,
            notifications: true,
            autoBreak: true,
            defaultWorkTime: 25,
            defaultBreakTime: 5
        };
        
        let timerInterval, totalTime, currentTime, isWorkSession = true, sessionCount = 0, streakCount = 0;
        let timerState = JSON.parse(localStorage.getItem('timerState')) || {
            isRunning: false,
            currentTime: 0,
            totalTime: 0,
            isWorkSession: true
        };
        
        let focusTimerInterval, focusTime, focusTotalTime, focusIsWorkSession = true;
        let currentModalAction = null;
        let currentFlashcardSet = null;
        let currentCardIndex = 0;
        let currentDate = new Date();

        // Chart Initialization
        const progressCtx = document.getElementById('progressChart').getContext('2d');
        const timeCtx = document.getElementById('timeChart').getContext('2d');
        const subjectCtx = document.getElementById('subjectChart').getContext('2d');
        
        let progressChart = new Chart(progressCtx, {
            type: 'bar',
            data: { 
                labels: [], 
                datasets: [{ 
                    label: 'Completed Tasks', 
                    data: [], 
                    backgroundColor: '#3498db',
                    borderColor: '#2980b9',
                    borderWidth: 1
                }] 
            },
            options: { 
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Tasks Completed by Subject'
                    }
                },
                scales: { 
                    y: { 
                        beginAtZero: true, 
                        title: { 
                            display: true, 
                            text: 'Tasks Completed' 
                        } 
                    } 
                } 
            }
        });
        
        let timeChart = new Chart(timeCtx, {
            type: 'line',
            data: { 
                labels: [], 
                datasets: [{ 
                    label: 'Study Time (minutes)', 
                    data: [], 
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: '#3498db',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }] 
            },
            options: { 
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Study Time Over Time'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Minutes'
                        }
                    }
                }
            }
        });
        
        let subjectChart = new Chart(subjectCtx, {
            type: 'doughnut',
            data: { 
                labels: [], 
                datasets: [{ 
                    label: 'Study Time by Subject', 
                    data: [], 
                    backgroundColor: [
                        '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                        '#9b59b6', '#1abc9c', '#d35400', '#c0392b'
                    ]
                }] 
            },
            options: { 
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Study Time Distribution by Subject'
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            applySettings();
            renderTasks();
            renderNotes();
            renderTimerHistory();
            updateCharts();
            updateSessionInfo();
            initializeTimer();
            updateDashboard();
            renderCalendar();
            renderFlashcardSets();
            renderGoals();
            
            document.getElementById('timer-preset').addEventListener('change', updateTimerPreset);
            
            // Initialize event listeners
            document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebar-close').addEventListener('click', toggleSidebar);
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });
            
            // Initialize task search and filter
            document.getElementById('task-search').addEventListener('input', renderTasks);
            document.getElementById('task-filter').addEventListener('change', renderTasks);
            document.getElementById('task-sort').addEventListener('change', renderTasks);
            
            // Initialize note search and filter
            document.getElementById('note-search').addEventListener('input', renderNotes);
            document.getElementById('note-filter').addEventListener('change', renderNotes);
        });

        // Sidebar Functions
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            // Update page title
            document.getElementById('page-title').textContent = document.querySelector(`[data-section="${sectionId}"]`).textContent.trim();
            
            // Close sidebar on mobile
            if (window.innerWidth <= 1024) {
                toggleSidebar();
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            // Update stats
            document.getElementById('total-tasks').textContent = tasks.filter(t => !t.archived).length;
            document.getElementById('total-notes').textContent = notes.length;
            document.getElementById('total-sessions').textContent = timerLogs.filter(log => log.type === 'work').length;
            document.getElementById('current-streak').textContent = streakCount;
            
            // Update badges
            document.getElementById('task-count').textContent = tasks.filter(t => !t.completed && !t.archived).length;
            document.getElementById('note-count').textContent = notes.length;
            
            // Update recent tasks
            const recentTasks = document.getElementById('recent-tasks');
            recentTasks.innerHTML = '';
            const recentTaskList = tasks
                .filter(t => !t.archived)
                .sort((a, b) => new Date(b.created) - new Date(a.created))
                .slice(0, 5);
            
            if (recentTaskList.length === 0) {
                recentTasks.innerHTML = '<li class="list-item text-center">No tasks yet. Add your first task!</li>';
            } else {
                recentTaskList.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `list-item ${task.completed ? 'completed' : ''}`;
                    li.innerHTML = `
                        <div class="list-item-content">
                            <div class="list-item-title">${task.subject}: ${task.description}</div>
                            <div class="list-item-meta">
                                <span>Due: ${task.deadline}</span>
                                <span>Priority: ${task.priority}</span>
                            </div>
                        </div>
                        <div class="list-item-actions">
                            <button class="complete" onclick="toggleComplete(${task.id})">
                                <i class="fas fa-${task.completed ? 'undo' : 'check'}"></i> ${task.completed ? 'Undo' : 'Complete'}
                            </button>
                        </div>
                    `;
                    recentTasks.appendChild(li);
                });
            }
            
            // Update recent notes
            const recentNotes = document.getElementById('recent-notes');
            recentNotes.innerHTML = '';
            const recentNoteList = notes
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 5);
            
            if (recentNoteList.length === 0) {
                recentNotes.innerHTML = '<li class="list-item text-center">No notes yet. Add your first note!</li>';
            } else {
                recentNoteList.forEach(note => {
                    const li = document.createElement('li');
                    li.className = `list-item ${note.pinned ? 'pinned' : ''}`;
                    li.innerHTML = `
                        <div class="list-item-content">
                            <div class="list-item-title">${note.content}</div>
                            <div class="list-item-meta">
                                <span>${note.tag}</span>
                                <span>${new Date(note.timestamp).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="list-item-actions">
                            <button class="pin" onclick="pinNote(${note.id})">
                                <i class="fas fa-thumbtack"></i> ${note.pinned ? 'Unpin' : 'Pin'}
                            </button>
                        </div>
                    `;
                    recentNotes.appendChild(li);
                });
            }
        }

        // Task Management (Enhanced)
        function addTask() {
            const subject = document.getElementById('task-subject').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const deadline = document.getElementById('task-deadline').value;
            const priority = document.getElementById('task-priority').value;
            const tags = document.getElementById('task-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            
            if (subject && description && deadline) {
                tasks.push({
                    id: Date.now(),
                    subject,
                    description,
                    deadline,
                    priority: parseInt(priority),
                    tags,
                    completed: false,
                    progress: 0,
                    created: new Date().toISOString(),
                    color: getPriorityColor(priority),
                    archived: false,
                    subtasks: []
                });
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                updateCharts();
                updateDashboard();
                clearTaskInputs();
                showModal('Success', 'Task added successfully!');
            } else {
                showModal('Error', 'Please fill all required fields.');
            }
        }

        function renderTasks() {
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = '';
            let filteredTasks = filterTasks();
            filteredTasks = sortTasks(filteredTasks);
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = '<li class="list-item text-center">No tasks found. Add a new task to get started!</li>';
                return;
            }
            
            filteredTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `list-item ${task.completed ? 'completed' : ''} fade-in`;
                li.style.borderLeft = `4px solid ${task.color}`;
                li.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${task.subject}: ${task.description}</div>
                        <div class="list-item-meta">
                            <span>Due: ${task.deadline}</span>
                            <span>Priority: ${task.priority}</span>
                            <span>Created: ${new Date(task.created).toLocaleDateString()}</span>
                        </div>
                        ${task.tags.length > 0 ? `
                        <div class="list-item-tags">
                            ${task.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        ` : ''}
                    </div>
                    <div class="list-item-actions">
                        <button class="complete" onclick="toggleComplete(${task.id})">
                            <i class="fas fa-${task.completed ? 'undo' : 'check'}"></i> ${task.completed ? 'Undo' : 'Complete'}
                        </button>
                        <button class="edit" onclick="editTask(${task.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete" onclick="deleteTask(${task.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                taskList.appendChild(li);
            });
        }

        function filterTasks() {
            const search = document.getElementById('task-search').value.toLowerCase();
            const filter = document.getElementById('task-filter').value;
            const today = new Date().toISOString().split('T')[0];
            
            return tasks.filter(task => {
                const matchesSearch = task.subject.toLowerCase().includes(search) || 
                                     task.description.toLowerCase().includes(search) ||
                                     task.tags.some(tag => tag.toLowerCase().includes(search));
                
                let matchesFilter = true;
                if (filter === 'completed') matchesFilter = task.completed;
                else if (filter === 'pending') matchesFilter = !task.completed;
                else if (filter === 'overdue') matchesFilter = !task.completed && task.deadline < today;
                
                return matchesSearch && matchesFilter && !task.archived;
            });
        }

        function sortTasks(taskArray) {
            const sortBy = document.getElementById('task-sort').value;
            return taskArray.sort((a, b) => {
                if (sortBy === 'date') return new Date(a.deadline) - new Date(b.deadline);
                if (sortBy === 'priority') return b.priority - a.priority;
                if (sortBy === 'subject') return a.subject.localeCompare(b.subject);
                if (sortBy === 'created') return new Date(b.created) - new Date(a.created);
                return 0;
            });
        }

        function toggleComplete(id) {
            const task = tasks.find(t => t.id === id);
            task.completed = !task.completed;
            task.progress = task.completed ? 100 : task.progress;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            updateCharts();
            updateDashboard();
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            document.getElementById('task-subject').value = task.subject;
            document.getElementById('task-description').value = task.description;
            document.getElementById('task-deadline').value = task.deadline;
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-tags').value = task.tags.join(', ');
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            updateCharts();
            updateDashboard();
        }

        function deleteTask(id) {
            showModal('Confirm Delete', 'Are you sure you want to delete this task?', () => {
                tasks = tasks.filter(t => t.id !== id);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                updateCharts();
                updateDashboard();
            });
        }

        function clearTaskFilters() {
            document.getElementById('task-search').value = '';
            document.getElementById('task-filter').value = 'all';
            document.getElementById('task-sort').value = 'date';
            renderTasks();
        }

        function clearTaskInputs() {
            document.getElementById('task-subject').value = '';
            document.getElementById('task-description').value = '';
            document.getElementById('task-deadline').value = '';
            document.getElementById('task-tags').value = '';
        }

        function getPriorityColor(priority) {
            return priority >= 4 ? '#e74c3c' : priority >= 2 ? '#f1c40f' : '#2ecc71';
        }

        // Note Management (Enhanced)
        function addNote() {
            const content = document.getElementById('note-content').value.trim();
            const tag = document.getElementById('note-tag').value;
            const color = document.getElementById('note-color').value;
            
            if (content) {
                notes.push({
                    id: Date.now(),
                    content,
                    tag,
                    color,
                    timestamp: new Date().toISOString(),
                    pinned: false
                });
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
                updateDashboard();
                document.getElementById('note-content').value = '';
                showModal('Success', 'Note added successfully!');
            } else {
                showModal('Error', 'Please enter a note.');
            }
        }

        function renderNotes() {
            const noteList = document.getElementById('note-list');
            noteList.innerHTML = '';
            let filteredNotes = filterNotes();
            filteredNotes.sort((a, b) => a.pinned ? -1 : b.pinned ? 1 : new Date(b.timestamp) - new Date(a.timestamp));
            
            if (filteredNotes.length === 0) {
                noteList.innerHTML = '<li class="list-item text-center">No notes found. Add a new note to get started!</li>';
                return;
            }
            
            filteredNotes.forEach(note => {
                const li = document.createElement('li');
                li.className = `list-item ${note.pinned ? 'pinned' : ''} fade-in`;
                li.style.borderLeft = `4px solid ${note.color}`;
                li.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${note.content}</div>
                        <div class="list-item-meta">
                            <span>${note.tag}</span>
                            <span>${new Date(note.timestamp).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="pin" onclick="pinNote(${note.id})">
                            <i class="fas fa-thumbtack"></i> ${note.pinned ? 'Unpin' : 'Pin'}
                        </button>
                        <button class="edit" onclick="editNote(${note.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete" onclick="deleteNote(${note.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button onclick="copyNote(${note.id})">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                `;
                noteList.appendChild(li);
            });
        }

        function filterNotes() {
            const search = document.getElementById('note-search').value.toLowerCase();
            const filter = document.getElementById('note-filter').value;
            return notes.filter(note => {
                const matchesSearch = note.content.toLowerCase().includes(search) || note.tag.toLowerCase().includes(search);
                const matchesFilter = filter === 'all' || note.tag === filter;
                return matchesSearch && matchesFilter;
            });
        }

        function pinNote(id) {
            const note = notes.find(n => n.id === id);
            note.pinned = !note.pinned;
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes();
            updateDashboard();
        }

        function editNote(id) {
            const note = notes.find(n => n.id === id);
            document.getElementById('note-content').value = note.content;
            document.getElementById('note-tag').value = note.tag;
            document.getElementById('note-color').value = note.color;
            notes = notes.filter(n => n.id !== id);
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes();
            updateDashboard();
        }

        function deleteNote(id) {
            showModal('Confirm Delete', 'Are you sure you want to delete this note?', () => {
                notes = notes.filter(n => n.id !== id);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
                updateDashboard();
            });
        }

        function copyNote(id) {
            const note = notes.find(n => n.id === id);
            navigator.clipboard.writeText(note.content);
            showModal('Success', 'Note copied to clipboard.');
        }

        function clearNoteFilters() {
            document.getElementById('note-search').value = '';
            document.getElementById('note-filter').value = 'all';
            renderNotes();
        }

        // Pomodoro Timer Functions (Enhanced)
        function initializeTimer() {
            if (timerState.isRunning) {
                currentTime = timerState.currentTime;
                totalTime = timerState.totalTime;
                isWorkSession = timerState.isWorkSession;
                startPomodoro(false);
            }
            updateTimerPreset();
        }

        function updateTimerPreset() {
            const preset = document.getElementById('timer-preset').value;
            if (preset !== 'custom') {
                const times = preset.split(',');
                document.getElementById('work-time').value = times[0];
                document.getElementById('break-time').value = times[1];
            }
        }

        function startPomodoro(playSound = true) {
            totalTime = (isWorkSession ? parseInt(document.getElementById('work-time').value) : parseInt(document.getElementById('break-time').value)) * 60;
            if (isNaN(totalTime) || totalTime <= 0) {
                showModal('Error', 'Please enter a valid time.');
                return;
            }
            if (!timerState.isRunning) currentTime = totalTime;
            clearInterval(timerInterval);
            document.getElementById('timer-status').textContent = isWorkSession ? 'Working' : 'Break';
            document.getElementById('pause-btn').style.display = 'inline-block';
            document.getElementById('resume-btn').style.display = 'none';
            updateProgressRing((totalTime - currentTime) / totalTime);
            timerInterval = setInterval(() => {
                const minutes = Math.floor(currentTime / 60);
                const seconds = currentTime % 60;
                document.getElementById('timer').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                updateProgressRing((totalTime - currentTime) / totalTime);
                currentTime--;
                timerState = { isRunning: true, currentTime, totalTime, isWorkSession };
                localStorage.setItem('timerState', JSON.stringify(timerState));
                if (currentTime < 0) {
                    clearInterval(timerInterval);
                    timerState.isRunning = false;
                    localStorage.setItem('timerState', JSON.stringify(timerState));
                    if (isWorkSession) {
                        sessionCount++;
                        streakCount++;
                        const subject = document.getElementById('timer-subject').value.trim() || 'General';
                        timerLogs.push({ id: Date.now(), type: 'work', duration: totalTime, subject, timestamp: new Date().toISOString() });
                        localStorage.setItem('timerLogs', JSON.stringify(timerLogs));
                        updateCharts();
                        renderTimerHistory();
                        updateDashboard();
                    }
                    isWorkSession = !isWorkSession;
                    totalTime = isWorkSession ? parseInt(document.getElementById('work-time').value) * 60 : parseInt(document.getElementById('break-time').value) * 60;
                    currentTime = totalTime;
                    document.getElementById('timer-status').textContent = isWorkSession ? 'Ready' : 'Break';
                    if (settings.sound && playSound) {
                        new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play().catch(() => {});
                    }
                    if (settings.autoBreak && !isWorkSession) {
                        showModal('Session Complete', 'Work session done! Starting break...', startPomodoro);
                    } else {
                        showModal('Session Complete', isWorkSession ? 'Break over! Start working?' : 'Work session done! Start break?', startPomodoro);
                    }
                    updateSessionInfo();
                }
            }, 1000);
        }

        function pausePomodoro() {
            clearInterval(timerInterval);
            timerState.isRunning = false;
            localStorage.setItem('timerState', JSON.stringify(timerState));
            document.getElementById('timer-status').textContent = 'Paused';
            document.getElementById('pause-btn').style.display = 'none';
            document.getElementById('resume-btn').style.display = 'inline-block';
        }

        function resumePomodoro() {
            startPomodoro(false);
        }

        function resetPomodoro() {
            clearInterval(timerInterval);
            currentTime = parseInt(document.getElementById('work-time').value) * 60;
            totalTime = currentTime;
            isWorkSession = true;
            timerState = { isRunning: false, currentTime, totalTime, isWorkSession };
            localStorage.setItem('timerState', JSON.stringify(timerState));
            document.getElementById('timer').textContent = `${Math.floor(currentTime / 60)}:00`;
            document.getElementById('timer-status').textContent = 'Ready';
            document.getElementById('pause-btn').style.display = 'inline-block';
            document.getElementById('resume-btn').style.display = 'none';
            updateProgressRing(0);
            updateSessionInfo();
        }

        function skipBreak() {
            if (!isWorkSession) {
                showModal('Confirm Skip', 'Skip the break session?', () => {
                    clearInterval(timerInterval);
                    isWorkSession = true;
                    totalTime = parseInt(document.getElementById('work-time').value) * 60;
                    currentTime = totalTime;
                    timerState = { isRunning: false, currentTime, totalTime, isWorkSession };
                    localStorage.setItem('timerState', JSON.stringify(timerState));
                    document.getElementById('timer-status').textContent = 'Ready';
                    startPomodoro();
                });
            }
        }

        function enterFocusMode() {
            const subject = document.getElementById('timer-subject').value.trim() || 'General';
            document.getElementById('focus-subject').textContent = subject;
            document.getElementById('focus-mode').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Initialize focus timer
            const workTime = parseInt(document.getElementById('work-time').value) * 60;
            startFocusTimer(workTime, true);
        }

        function exitFocusMode() {
            document.getElementById('focus-mode').classList.remove('active');
            document.body.style.overflow = 'auto';
            clearInterval(focusTimerInterval);
        }

        function startFocusTimer(duration, isWork = true) {
            focusTime = duration;
            focusTotalTime = duration;
            focusIsWorkSession = isWork;
            const focusTimerElement = document.getElementById('focus-timer');
            const focusStatusElement = document.getElementById('focus-status');
            
            focusStatusElement.textContent = isWork ? 'Working' : 'Break';
            document.getElementById('focus-pause-btn').style.display = 'inline-block';
            document.getElementById('focus-resume-btn').style.display = 'none';
            
            clearInterval(focusTimerInterval);
            focusTimerInterval = setInterval(() => {
                const minutes = Math.floor(focusTime / 60);
                const seconds = focusTime % 60;
                focusTimerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                updateFocusProgressRing((focusTotalTime - focusTime) / focusTotalTime);
                focusTime--;
                
                if (focusTime < 0) {
                    clearInterval(focusTimerInterval);
                    if (isWork) {
                        sessionCount++;
                        streakCount++;
                        const subject = document.getElementById('timer-subject').value.trim() || 'General';
                        timerLogs.push({ id: Date.now(), type: 'work', duration: duration, subject, timestamp: new Date().toISOString() });
                        localStorage.setItem('timerLogs', JSON.stringify(timerLogs));
                        updateCharts();
                        renderTimerHistory();
                        updateDashboard();
                        
                        if (settings.autoBreak) {
                            const breakTime = parseInt(document.getElementById('break-time').value) * 60;
                            startFocusTimer(breakTime, false);
                        } else {
                            showModal('Session Complete', 'Work session done! Take a break.', () => {
                                const breakTime = parseInt(document.getElementById('break-time').value) * 60;
                                startFocusTimer(breakTime, false);
                            });
                        }
                    } else {
                        showModal('Break Complete', 'Break over! Ready to work again?', () => {
                            const workTime = parseInt(document.getElementById('work-time').value) * 60;
                            startFocusTimer(workTime, true);
                        });
                    }
                    updateFocusSessionInfo();
                }
            }, 1000);
        }

        function pauseFocusTimer() {
            clearInterval(focusTimerInterval);
            document.getElementById('focus-status').textContent = 'Paused';
            document.getElementById('focus-pause-btn').style.display = 'none';
            document.getElementById('focus-resume-btn').style.display = 'inline-block';
        }

        function resumeFocusTimer() {
            startFocusTimer(focusTime, focusIsWorkSession);
        }

        function resetFocusTimer() {
            clearInterval(focusTimerInterval);
            const workTime = parseInt(document.getElementById('work-time').value) * 60;
            document.getElementById('focus-timer').textContent = `${Math.floor(workTime / 60)}:00`;
            document.getElementById('focus-status').textContent = 'Ready';
            document.getElementById('focus-pause-btn').style.display = 'inline-block';
            document.getElementById('focus-resume-btn').style.display = 'none';
            updateFocusProgressRing(0);
        }

        function toggleFocusMode() {
            if (document.getElementById('focus-mode').classList.contains('active')) {
                exitFocusMode();
            } else {
                enterFocusMode();
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function updateProgressRing(progress) {
            const circle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 90;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference * (1 - progress);
        }

        function updateFocusProgressRing(progress) {
            const circle = document.getElementById('focus-progress-circle');
            const circumference = 2 * Math.PI * 90;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference * (1 - progress);
        }

        function updateSessionInfo() {
            document.getElementById('session-count').textContent = sessionCount;
            document.getElementById('streak-count').textContent = streakCount;
        }

        function updateFocusSessionInfo() {
            document.getElementById('focus-session-count').textContent = sessionCount;
            document.getElementById('focus-streak-count').textContent = streakCount;
        }

        function renderTimerHistory() {
            const historyList = document.getElementById('timer-history');
            historyList.innerHTML = '';
            timerLogs.slice(-10).reverse().forEach(log => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${log.type === 'work' ? 'Work' : 'Break'} session (${log.subject || 'General'})</div>
                        <div class="list-item-meta">
                            <span>${Math.floor(log.duration / 60)} minutes</span>
                            <span>${new Date(log.timestamp).toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="delete" onclick="deleteTimerLog(${log.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                historyList.appendChild(li);
            });
        }

        function deleteTimerLog(id) {
            showModal('Confirm Delete', 'Delete this timer log?', () => {
                timerLogs = timerLogs.filter(log => log.id !== id);
                localStorage.setItem('timerLogs', JSON.stringify(timerLogs));
                renderTimerHistory();
                updateCharts();
            });
        }

        // Calendar Functions
        function renderCalendar() {
            const calendarBody = document.getElementById('calendar-body');
            const monthYear = document.getElementById('calendar-month-year');
            
            // Set month and year
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear calendar
            calendarBody.innerHTML = '';
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Create calendar rows
            let date = 1;
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    
                    if (i === 0 && j < startingDay) {
                        // Empty cells before the first day of the month
                        cell.textContent = '';
                    } else if (date > daysInMonth) {
                        // Empty cells after the last day of the month
                        cell.textContent = '';
                    } else {
                        // Date cells
                        cell.textContent = date;
                        
                        // Check if today
                        const today = new Date();
                        if (date === today.getDate() && 
                            currentDate.getMonth() === today.getMonth() && 
                            currentDate.getFullYear() === today.getFullYear()) {
                            cell.classList.add('today');
                        }
                        
                        // Check for events
                        const cellDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), date);
                        const dateString = cellDate.toISOString().split('T')[0];
                        const events = calendarEvents.filter(event => event.date === dateString);
                        
                        if (events.length > 0) {
                            cell.classList.add('has-event');
                            events.forEach(event => {
                                const eventEl = document.createElement('div');
                                eventEl.className = 'calendar-event';
                                eventEl.textContent = event.title;
                                cell.appendChild(eventEl);
                            });
                        }
                        
                        date++;
                    }
                    
                    row.appendChild(cell);
                }
                
                calendarBody.appendChild(row);
                
                // Stop creating rows if we've displayed all days
                if (date > daysInMonth) {
                    break;
                }
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }

        // Flashcard Functions
        function createFlashcardSet() {
            const name = document.getElementById('flashcard-set-name').value.trim();
            const subject = document.getElementById('flashcard-subject').value;
            
            if (name) {
                const newSet = {
                    id: Date.now(),
                    name,
                    subject,
                    cards: []
                };
                
                flashcardSets.push(newSet);
                localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                renderFlashcardSets();
                document.getElementById('flashcard-set-name').value = '';
                showModal('Success', 'Flashcard set created!');
            } else {
                showModal('Error', 'Please enter a set name.');
            }
        }

        function renderFlashcardSets() {
            const setsContainer = document.getElementById('flashcard-sets');
            setsContainer.innerHTML = '';
            
            if (flashcardSets.length === 0) {
                setsContainer.innerHTML = '<p class="text-center">No flashcard sets yet. Create your first set!</p>';
                return;
            }
            
            flashcardSets.forEach(set => {
                const setElement = document.createElement('div');
                setElement.className = 'flashcard-set';
                setElement.innerHTML = `
                    <div class="flashcard-set-header">
                        <h3>${set.name} (${set.subject})</h3>
                        <div>
                            <button onclick="studyFlashcardSet(${set.id})"><i class="fas fa-play"></i> Study</button>
                            <button onclick="deleteFlashcardSet(${set.id})" class="delete"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                    </div>
                    <p>${set.cards.length} cards</p>
                `;
                setsContainer.appendChild(setElement);
            });
        }

        function addFlashcard() {
            const front = document.getElementById('flashcard-front').value.trim();
            const back = document.getElementById('flashcard-back').value.trim();
            
            if (front && back && currentFlashcardSet) {
                const set = flashcardSets.find(s => s.id === currentFlashcardSet);
                if (set) {
                    set.cards.push({ front, back });
                    localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                    document.getElementById('flashcard-front').value = '';
                    document.getElementById('flashcard-back').value = '';
                    showModal('Success', 'Flashcard added!');
                }
            } else {
                showModal('Error', 'Please select a set and enter both front and back content.');
            }
        }

        function studyFlashcardSet(setId) {
            currentFlashcardSet = setId;
            const set = flashcardSets.find(s => s.id === setId);
            
            if (set && set.cards.length > 0) {
                document.getElementById('flashcard-sets').style.display = 'none';
                document.getElementById('active-flashcard').style.display = 'block';
                
                currentCardIndex = 0;
                showCard();
            } else {
                showModal('Error', 'This set has no cards. Add some cards first.');
            }
        }

        function showCard() {
            const set = flashcardSets.find(s => s.id === currentFlashcardSet);
            if (set && set.cards[currentCardIndex]) {
                document.getElementById('flashcard-front-text').textContent = set.cards[currentCardIndex].front;
                document.getElementById('flashcard-back-text').textContent = set.cards[currentCardIndex].back;
                document.getElementById('card-counter').textContent = `Card ${currentCardIndex + 1} of ${set.cards.length}`;
                
                // Reset card to front
                document.getElementById('flashcard').classList.remove('flipped');
            }
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function nextCard() {
            const set = flashcardSets.find(s => s.id === currentFlashcardSet);
            if (set) {
                currentCardIndex = (currentCardIndex + 1) % set.cards.length;
                showCard();
            }
        }

        function previousCard() {
            const set = flashcardSets.find(s => s.id === currentFlashcardSet);
            if (set) {
                currentCardIndex = (currentCardIndex - 1 + set.cards.length) % set.cards.length;
                showCard();
            }
        }

        function shuffleCards() {
            const set = flashcardSets.find(s => s.id === currentFlashcardSet);
            if (set) {
                // Fisher-Yates shuffle
                for (let i = set.cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [set.cards[i], set.cards[j]] = [set.cards[j], set.cards[i]];
                }
                localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                currentCardIndex = 0;
                showCard();
                showModal('Success', 'Cards shuffled!');
            }
        }

        function deleteFlashcardSet(setId) {
            showModal('Confirm Delete', 'Are you sure you want to delete this flashcard set?', () => {
                flashcardSets = flashcardSets.filter(set => set.id !== setId);
                localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                renderFlashcardSets();
            });
        }

        // Goals Functions
        function addGoal() {
            const title = document.getElementById('goal-title').value.trim();
            const description = document.getElementById('goal-description').value.trim();
            const deadline = document.getElementById('goal-deadline').value;
            
            if (title && deadline) {
                goals.push({
                    id: Date.now(),
                    title,
                    description,
                    deadline,
                    completed: false,
                    progress: 0,
                    created: new Date().toISOString()
                });
                localStorage.setItem('goals', JSON.stringify(goals));
                renderGoals();
                document.getElementById('goal-title').value = '';
                document.getElementById('goal-description').value = '';
                document.getElementById('goal-deadline').value = '';
                showModal('Success', 'Goal added successfully!');
            } else {
                showModal('Error', 'Please fill all required fields.');
            }
        }

        function renderGoals() {
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';
            
            if (goals.length === 0) {
                goalsList.innerHTML = '<p class="text-center">No goals yet. Set your first study goal!</p>';
                return;
            }
            
            goals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.className = `list-item ${goal.completed ? 'completed' : ''}`;
                goalElement.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${goal.title}</div>
                        <div class="list-item-meta">
                            <span>Target: ${goal.deadline}</span>
                            <span>Progress: ${goal.progress}%</span>
                        </div>
                        ${goal.description ? `<p>${goal.description}</p>` : ''}
                    </div>
                    <div class="list-item-actions">
                        <button class="complete" onclick="toggleGoalComplete(${goal.id})">
                            <i class="fas fa-${goal.completed ? 'undo' : 'check'}"></i> ${goal.completed ? 'Undo' : 'Complete'}
                        </button>
                        <button class="delete" onclick="deleteGoal(${goal.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                goalsList.appendChild(goalElement);
            });
        }

        function toggleGoalComplete(id) {
            const goal = goals.find(g => g.id === id);
            goal.completed = !goal.completed;
            goal.progress = goal.completed ? 100 : goal.progress;
            localStorage.setItem('goals', JSON.stringify(goals));
            renderGoals();
        }

        function deleteGoal(id) {
            showModal('Confirm Delete', 'Are you sure you want to delete this goal?', () => {
                goals = goals.filter(g => g.id !== id);
                localStorage.setItem('goals', JSON.stringify(goals));
                renderGoals();
            });
        }

        // Analytics (Enhanced)
        function updateCharts() {
            const period = parseInt(document.getElementById('analytics-period').value);
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - period);
            
            // Filter data by period
            const filteredTasks = tasks.filter(task => new Date(task.created) >= cutoffDate);
            const filteredLogs = timerLogs.filter(log => new Date(log.timestamp) >= cutoffDate);
            
            // Get unique subjects
            const subjects = [...new Set(filteredTasks.map(task => task.subject).concat(filteredLogs.map(log => log.subject || 'General')))];
            
            // Task completion data
            const completedCounts = subjects.map(subject =>
                filteredTasks.filter(task => task.subject === subject && task.completed).length
            );
            
            // Study time data
            const timeBySubject = subjects.map(subject =>
                filteredLogs.filter(log => log.subject === subject && log.type === 'work').reduce((sum, log) => sum + log.duration, 0) / 60
            );
            
            // Study time over time
            const dates = [];
            const studyTimes = [];
            for (let i = period - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                dates.push(dateStr);
                
                const dayLogs = filteredLogs.filter(log => {
                    const logDate = new Date(log.timestamp).toISOString().split('T')[0];
                    return logDate === dateStr && log.type === 'work';
                });
                
                const totalMinutes = dayLogs.reduce((sum, log) => sum + (log.duration / 60), 0);
                studyTimes.push(totalMinutes);
            }
            
            // Update charts
            progressChart.data.labels = subjects;
            progressChart.data.datasets[0].data = completedCounts;
            progressChart.update();
            
            timeChart.data.labels = dates;
            timeChart.data.datasets[0].data = studyTimes;
            timeChart.update();
            
            subjectChart.data.labels = subjects;
            subjectChart.data.datasets[0].data = timeBySubject;
            subjectChart.update();
        }

        // PDF Export Functions
        function exportTasksToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('StudyBuddy Tasks', 20, 20);
            doc.setFontSize(12);
            
            let y = 40;
            tasks.forEach((task, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.setFillColor(240, 240, 240);
                doc.rect(20, y, 170, 20, 'F');
                doc.setTextColor(0, 0, 0);
                doc.text(`${task.subject}: ${task.description}`, 25, y + 8);
                doc.setTextColor(100, 100, 100);
                doc.text(`Due: ${task.deadline} | Priority: ${task.priority} | Status: ${task.completed ? 'Completed' : 'Pending'}`, 25, y + 15);
                
                y += 25;
            });
            
            doc.save('studybuddy-tasks.pdf');
            showModal('Success', 'Tasks exported to PDF successfully!');
        }

        function exportNotesToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('StudyBuddy Notes', 20, 20);
            doc.setFontSize(12);
            
            let y = 40;
            notes.forEach((note, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                // Split note content into lines that fit the page width
                const lines = doc.splitTextToSize(note.content, 170);
                
                // Calculate height needed for this note
                const noteHeight = 10 + (lines.length * 6);
                
                doc.setFillColor(240, 240, 240);
                doc.rect(20, y, 170, noteHeight, 'F');
                doc.setTextColor(0, 0, 0);
                doc.text(lines, 25, y + 8);
                doc.setTextColor(100, 100, 100);
                doc.text(`Category: ${note.tag} | Created: ${new Date(note.timestamp).toLocaleDateString()}`, 25, y + noteHeight - 3);
                
                y += noteHeight + 5;
            });
            
            doc.save('studybuddy-notes.pdf');
            showModal('Success', 'Notes exported to PDF successfully!');
        }

        // Settings (Enhanced)
        function applySettings() {
            document.body.style.fontSize = settings.fontSize;
            changeTheme();
            document.getElementById('theme-select').value = settings.theme;
            document.getElementById('font-size').value = parseInt(settings.fontSize);
            document.getElementById('sound-toggle').checked = settings.sound;
            document.getElementById('notifications-toggle').checked = settings.notifications;
            document.getElementById('auto-break-toggle').checked = settings.autoBreak;
            document.getElementById('default-work-time').value = settings.defaultWorkTime;
            document.getElementById('default-break-time').value = settings.defaultBreakTime;
            
            // Apply default timer values
            document.getElementById('work-time').value = settings.defaultWorkTime;
            document.getElementById('break-time').value = settings.defaultBreakTime;
        }

        function changeTheme() {
            const theme = document.getElementById('theme-select').value;
            settings.theme = theme;
            document.body.className = '';
            if (theme !== 'light') {
                document.body.classList.add(`${theme}-theme`);
            }
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function changeFontSize() {
            settings.fontSize = document.getElementById('font-size').value + 'px';
            document.body.style.fontSize = settings.fontSize;
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function toggleSound() {
            settings.sound = document.getElementById('sound-toggle').checked;
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function toggleNotifications() {
            settings.notifications = document.getElementById('notifications-toggle').checked;
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function toggleAutoBreak() {
            settings.autoBreak = document.getElementById('auto-break-toggle').checked;
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function updateDefaultWorkTime() {
            settings.defaultWorkTime = parseInt(document.getElementById('default-work-time').value);
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function updateDefaultBreakTime() {
            settings.defaultBreakTime = parseInt(document.getElementById('default-break-time').value);
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function resetData() {
            showModal('Confirm Reset', 'Are you sure you want to reset all data? This action cannot be undone.', () => {
                tasks = [];
                notes = [];
                timerLogs = [];
                goals = [];
                flashcardSets = [];
                calendarEvents = [];
                sessionCount = 0;
                streakCount = 0;
                timerState = { isRunning: false, currentTime: 0, totalTime: 0, isWorkSession: true };
                localStorage.clear();
                renderTasks();
                renderNotes();
                renderTimerHistory();
                updateCharts();
                updateSessionInfo();
                updateDashboard();
                renderCalendar();
                renderFlashcardSets();
                renderGoals();
                resetPomodoro();
                showModal('Success', 'All data has been reset.');
            });
        }

        function exportData() {
            const data = { tasks, notes, timerLogs, goals, flashcardSets, calendarEvents, settings, timerState };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'studybuddy-data.json';
            a.click();
            URL.revokeObjectURL(url);
            showModal('Success', 'Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        tasks = data.tasks || [];
                        notes = data.notes || [];
                        timerLogs = data.timerLogs || [];
                        goals = data.goals || [];
                        flashcardSets = data.flashcardSets || [];
                        calendarEvents = data.calendarEvents || [];
                        settings = data.settings || settings;
                        timerState = data.timerState || timerState;
                        localStorage.setItem('tasks', JSON.stringify(tasks));
                        localStorage.setItem('notes', JSON.stringify(notes));
                        localStorage.setItem('timerLogs', JSON.stringify(timerLogs));
                        localStorage.setItem('goals', JSON.stringify(goals));
                        localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                        localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
                        localStorage.setItem('settings', JSON.stringify(settings));
                        localStorage.setItem('timerState', JSON.stringify(timerState));
                        applySettings();
                        renderTasks();
                        renderNotes();
                        renderTimerHistory();
                        updateCharts();
                        updateDashboard();
                        renderCalendar();
                        renderFlashcardSets();
                        renderGoals();
                        initializeTimer();
                        showModal('Success', 'Data imported successfully!');
                    } catch (error) {
                        showModal('Error', 'Failed to import data. The file may be corrupted.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Modal Functions
        function showModal(title, message, action = null) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal').style.display = 'flex';
            currentModalAction = action;
        }

        function confirmModal() {
            if (currentModalAction) currentModalAction();
            closeModal();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            currentModalAction = null;
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', e => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 't': e.preventDefault(); addTask(); break;
                    case 'n': e.preventDefault(); addNote(); break;
                    case 'p': e.preventDefault(); startPomodoro(); break;
                    case 'f': e.preventDefault(); enterFocusMode(); break;
                    case 'd': e.preventDefault(); showSection('dashboard'); break;
                    case 's': e.preventDefault(); showSection('settings'); break;
                }
            }
            
            // Escape key to exit focus mode
            if (e.key === 'Escape' && document.getElementById('focus-mode').classList.contains('active')) {
                exitFocusMode();
            }
            
            // Escape key to close modal
            if (e.key === 'Escape') {
                closeModal();
            }
            
            // Space bar to flip flashcard
            if (e.key === ' ' && document.getElementById('active-flashcard').style.display !== 'none') {
                e.preventDefault();
                flipCard();
            }
            
            // Arrow keys for flashcards
            if (document.getElementById('active-flashcard').style.display !== 'none') {
                if (e.key === 'ArrowRight') {
                    nextCard();
                } else if (e.key === 'ArrowLeft') {
                    previousCard();
                }
            }
        });

        // Initialize with dashboard
        showSection('dashboard');
    </script>
</body>
</html>
